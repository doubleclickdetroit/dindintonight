// Generated by CoffeeScript 1.6.3
(function(){var e,t,n,r,i=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};n=window.dd.Models;e=window.dd.Views.BaseView;t=function(e){function t(){this.handleEnterKeyEvent=i(this.handleEnterKeyEvent,this);this.handleLocationLookup=i(this.handleLocationLookup,this);r=t.__super__.constructor.apply(this,arguments);return r}o(t,e);t.prototype.events={"click #btn-location":"handleLocationLookup"};t.prototype.initialize=function(){var e=this;t.__super__.initialize.apply(this,arguments);this.model=new n.LocationModel;this.map=null;this.marker=null;this.$txt_location=this.$("#physical_location");this.canvas_map=this.$("#geo_map").get(0);this.geocoder=new google.maps.Geocoder;$("#btn-location").click(this.handleLocationLookup);$("#physical_location").focus(function(){return $(document).bind("keypress",e.handleEnterKeyEvent)});$("#physical_location").blur(function(){return $(document).unbind("keypress",e.handleEnterKeyEvent)});this.model.on("change:latlng",this.render,this);return this.setupMap()};t.prototype.setupMap=function(){var e,t;e=new google.maps.LatLng(42.33556,-83.04926999999998);t={zoom:16,center:e,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};return this.map=new google.maps.Map(this.canvas_map,t)};t.prototype.render=function(){var e;e=this.model.get("latlng");this.marker&&this.marker.setMap(null);this.events.trigger("app","success","We found ya! Let's eat some DinDin.","Checkout now.");this.map.setCenter(e);this.marker=new google.maps.Marker({map:this.map,position:e});return this.events.trigger("location","change")};t.prototype.handleLocationLookup=function(){var e,t=this;e=this.$txt_location.val();return this.geocoder.geocode({address:e},function(e,n){return n===google.maps.GeocoderStatus.OK?t.model.set({latlng:e[0].geometry.location}):t.events.trigger("app","error","Uh Oh! We're armed with the power of Google Maps. Try a real address there next time, Buckaroo.")})};t.prototype.handleEnterKeyEvent=function(e){if(e.which===13)return this.handleLocationLookup()};return t}(e);window.dd.Views.LocationView=t}).call(this);